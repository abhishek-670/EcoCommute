{% extends 'rides/base.html' %}

{% block title %}Verify Aadhaar - EcoCommute{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-green-600 mb-6 flex items-center">
            <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            Aadhaar Verification
        </h1>

        <!-- Why Verification Required -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">Why Aadhaar Verification?</h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <p>Aadhaar verification helps us ensure:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>Safety and security for all users</li>
                            <li>Identity verification of ride creators and passengers</li>
                            <li>Compliance with government regulations</li>
                            <li>Trust and accountability in our community</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Privacy & Security Notice -->
        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-green-800">Your Privacy is Protected</h3>
                    <div class="mt-2 text-sm text-green-700">
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Your Aadhaar number is NEVER stored</strong> in our database</li>
                            <li>We only store verification status and last 4 digits (e.g., XXXX-XXXX-1234)</li>
                            <li>Verification is done through licensed providers (Cashfree/Signzy/Surepass)</li>
                            <li>All data transmission is encrypted (HTTPS)</li>
                            <li>Compliant with Aadhaar Act 2016 & DPDP Act 2023</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aadhaar Input Form -->
        <form method="POST" action="{% url 'aadhaar_send_otp' %}" class="space-y-6">
            {% csrf_token %}

            <!-- Aadhaar Number Input -->
            <div>
                <label for="aadhaar_number" class="block text-sm font-semibold text-gray-700 mb-2">
                    Aadhaar Number <span class="text-red-500">*</span>
                </label>
                <input 
                    type="text" 
                    id="aadhaar_number" 
                    name="aadhaar_number" 
                    maxlength="14"
                    placeholder="1234-5678-9012"
                    pattern="[0-9]{4}-?[0-9]{4}-?[0-9]{4}"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-lg"
                />
                <p class="mt-2 text-sm text-gray-600">
                    Enter your 12-digit Aadhaar number. You can use hyphens (1234-5678-9012) or without (123456789012).
                </p>
            </div>

            <!-- OTP Delivery Info -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex">
                    <svg class="h-5 w-5 text-yellow-600 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <div class="text-sm text-yellow-800">
                        <p class="font-semibold">Important:</p>
                        <p class="mt-1">OTP will be sent to your <strong>Aadhaar-linked mobile number</strong>. Make sure you have access to this number.</p>
                    </div>
                </div>
            </div>

            <!-- Consent Checkbox (MANDATORY) -->
            <div class="border-2 border-gray-300 rounded-lg p-4 bg-gray-50">
                <div class="flex items-start">
                    <input 
                        type="checkbox" 
                        id="consent" 
                        name="consent" 
                        required
                        class="mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded"
                    />
                    <label for="consent" class="ml-3 text-sm text-gray-700">
                        <span class="font-semibold text-gray-900">I hereby give my consent</span> to use my Aadhaar number for verification purposes. I understand that:
                        <ul class="list-disc list-inside mt-2 space-y-1 text-gray-600">
                            <li>My Aadhaar number will be verified through a licensed provider</li>
                            <li>Only verification status and last 4 digits will be stored</li>
                            <li>Full Aadhaar number will NOT be stored in any database</li>
                            <li>This verification is required to use ride services</li>
                            <li>I can contact support for data deletion requests</li>
                        </ul>
                        <p class="mt-2 text-xs text-gray-500">
                            By checking this box, you agree to the <a href="#" class="text-blue-600 underline">Aadhaar Verification Terms</a> and <a href="#" class="text-blue-600 underline">Privacy Policy</a>.
                        </p>
                    </label>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex gap-4">
                <button 
                    type="submit" 
                    class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 px-6 rounded-lg hover:from-green-600 hover:to-emerald-700 transition duration-200 shadow-lg flex items-center justify-center"
                >
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    Send OTP
                </button>
                
                <a 
                    href="{% url 'dashboard' %}" 
                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg transition duration-200 text-center"
                >
                    Skip for Now
                </a>
            </div>
        </form>

        <!-- Help Section -->
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-3">Need Help?</h3>
            <div class="space-y-2 text-sm text-gray-600">
                <p><strong>Don't have your Aadhaar card?</strong> You can find your Aadhaar number on your physical card or download e-Aadhaar from <a href="https://uidai.gov.in" target="_blank" class="text-blue-600 underline">uidai.gov.in</a></p>
                <p><strong>Changed your mobile number?</strong> Update your mobile number with UIDAI before verification.</p>
                <p><strong>Having issues?</strong> Contact our support at <a href="mailto:support@ecocommute.com" class="text-blue-600 underline">support@ecocommute.com</a></p>
            </div>
        </div>

        <!-- Legal Compliance Notice -->
        <div class="mt-6 p-4 bg-gray-100 rounded-lg text-xs text-gray-600">
            <p class="font-semibold mb-1">Legal Compliance:</p>
            <p>This service complies with the Aadhaar (Targeted Delivery of Financial and Other Subsidies, Benefits and Services) Act, 2016 and the Digital Personal Data Protection Act (DPDP) 2023. Your Aadhaar data is processed only for identity verification and is handled by licensed verification providers approved by UIDAI.</p>
        </div>
    </div>
</div>

<script>
// Format Aadhaar number with hyphens as user types
document.getElementById('aadhaar_number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
    
    if (value.length > 12) {
        value = value.slice(0, 12);
    }
    
    // Add hyphens after every 4 digits
    if (value.length > 8) {
        value = value.slice(0, 4) + '-' + value.slice(4, 8) + '-' + value.slice(8);
    } else if (value.length > 4) {
        value = value.slice(0, 4) + '-' + value.slice(4);
    }
    
    e.target.value = value;
});

// Validate consent before submit
document.querySelector('form').addEventListener('submit', function(e) {
    const consent = document.getElementById('consent');
    if (!consent.checked) {
        e.preventDefault();
        alert('You must give consent to proceed with Aadhaar verification.');
        consent.focus();
    }
});
</script>
{% endblock %}
